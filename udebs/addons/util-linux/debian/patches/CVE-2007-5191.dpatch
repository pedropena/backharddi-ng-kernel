#! /bin/sh /usr/share/dpatch/dpatch-run

@DPATCH@
--- ../old/util-linux-2.12r/mount/mount.c	2007-12-22 13:07:40.000000000 +0000
+++ util-linux-2.12r/mount/mount.c	2007-12-22 13:40:00.000000000 +0000
@@ -491,8 +491,12 @@
 		 const char *oo, *mountargs[10];
 		 int i = 0;
 
-		 setuid(getuid());
-		 setgid(getgid());
+                 if(setgid(getgid()) < 0)
+                          die(EX_FAIL, _("mount: cannot set group id: %s"), strerror(errno));
+
+                  if(setuid(getuid()) < 0)
+                          die(EX_FAIL, _("mount: cannot set user id: %s"), strerror(errno));
+
 		 oo = fix_opts_string (flags, extra_opts, NULL);
 		 mountargs[i++] = mountprog;
 		 mountargs[i++] = spec;
--- ../old/util-linux-2.12r/mount/umount.c	2007-12-22 13:07:40.000000000 +0000
+++ util-linux-2.12r/mount/umount.c	2007-12-22 13:40:34.000000000 +0000
@@ -118,8 +118,12 @@
 				char *umountargs[8];
 				int i = 0;
 
-				setuid(getuid());
-				setgid(getgid());
+                                if(setgid(getgid()) < 0)
+                                         die(EX_FAIL, _("umount: cannot set group id: %s"), strerror(errno));
+
+                                if(setuid(getuid()) < 0)
+                                         die(EX_FAIL, _("umount: cannot set user id: %s"), strerror(errno));
+
 				umountargs[i++] = umountprog;
 				umountargs[i++] = xstrdup(node);
 				if (nomtab)
